# 产品需求文档 (PRD) - AI文档阅读器

## 文档信息
- **产品名称**：DocAgent - AI智能文档阅读器
- **版本**：v1.0
- **创建日期**：2025-11-12
- **作者**：li.hongjian@51talk.com
- **状态**：草案

---

## 1. 产品概述

### 1.1 产品定位
DocAgent 是一款基于AI技术的智能文档阅读器，首期支持PDF文档的智能翻译和对话问答功能，帮助用户高效阅读和理解外文文档。

### 1.2 目标用户
- 需要阅读外文技术文档的开发者
- 需要阅读学术论文的研究人员
- 需要处理跨语言文档的商务人士

### 1.3 核心价值
- **智能翻译**：基于AI的高质量文档翻译，支持原文对照
- **智能问答**：针对文档内容进行上下文感知的智能对话
- **高效阅读**：选中联动、高亮定位等交互功能提升阅读效率

---

## 2. 功能需求

### 2.1 PDF文档管理

#### 2.1.1 文档上传
- **功能描述**：支持用户上传PDF文档
- **交互方式**：
  - 拖拽上传
  - 点击按钮选择文件上传
- **限制条件**：
  - 文件大小：≤ 50MB
  - 文件格式：.pdf
- **错误处理**：
  - 文件格式错误提示
  - 文件过大提示
  - 上传失败重试机制

#### 2.1.2 文档预览
- **功能描述**：展示PDF原文内容
- **基本能力**：
  - 分页显示
  - 缩放（50% - 200%）
  - 适应页面宽度
  - 文本选中
- **性能要求**：
  - 首页渲染时间 < 2s
  - 翻页响应时间 < 500ms

---

### 2.2 AI翻译功能

#### 2.2.1 全文翻译
- **功能描述**：对PDF文档进行全文AI翻译
- **触发方式**：点击「翻译」按钮
- **翻译流程**：
  1. 提取PDF文本内容
  2. 调用AI翻译服务进行翻译
  3. 保持原文格式和段落结构
  4. 展示翻译结果

#### 2.2.2 对照翻译模式
- **功能描述**：原文与译文并排对照显示
- **布局方式**：
  - 左侧：PDF原文
  - 右侧：翻译文本
  - 分隔线可拖动调整比例
- **联动交互**：
  - **选中联动**：选中原文段落后，右侧译文对应段落自动高亮
  - **滚动同步**：左右两侧滚动位置同步（可选开关）
  - **段落映射**：建立原文段落与译文段落的映射关系

#### 2.2.3 下载翻译文档
- **功能描述**：将翻译后的文档导出下载
- **导出格式**：
  - PDF（保持原文格式，替换为译文）
  - TXT（纯文本格式）
  - 双语对照PDF（原文+译文）
- **文件命名**：`{原文件名}_translated_{语言}_{时间戳}.{格式}`

#### 2.2.4 翻译设置
- **源语言**：自动检测 / 手动选择
- **目标语言**：中文 / 英文 / 日文等
- **翻译风格**：
  - 准确（技术文档）
  - 流畅（通用文档）
  - 简洁（快速阅读）

---

### 2.3 AI对话功能

#### 2.3.1 全文对话
- **功能描述**：基于整个文档内容进行AI问答
- **交互位置**：右侧对话面板（可折叠）
- **对话能力**：
  - 文档摘要
  - 关键信息提取
  - 内容解释说明
  - 多轮对话上下文保持
- **输入方式**：
  - 文本输入框
  - 快捷提问模板（"总结这篇文档"、"列出要点"等）

#### 2.3.2 选中内容提问
- **功能描述**：针对选中的文档片段进行提问
- **触发方式**：
  - 选中文本后，出现悬浮工具栏
  - 点击「提问」图标
- **交互流程**：
  1. 用户选中文本
  2. 弹出提问框，自动携带选中内容作为上下文
  3. 用户输入问题
  4. AI基于选中内容回答
- **预设问题**：
  - "解释这段内容"
  - "翻译这段文字"
  - "这段话的关键点是什么"

#### 2.3.3 对话历史
- **功能描述**：保存当前文档的对话记录
- **能力**：
  - 对话记录列表
  - 点击历史对话可跳转到对应内容
  - 清空历史记录
  - 导出对话记录（TXT/Markdown）

---

## 3. 技术架构设计

### 3.1 前端架构

#### 3.1.1 技术栈
- **框架**：React 18+ (使用 Hooks)
- **状态管理**：Zustand / Redux Toolkit
- **路由**：React Router v6
- **UI组件库**：Ant Design (定制水墨风格主题)
- **PDF渲染**：react-pdf / pdfjs-dist
- **样式方案**：CSS Modules + Tailwind CSS
- **HTTP客户端**：Axios
- **构建工具**：Vite

#### 3.1.2 目录结构
```
frontend/
├── src/
│   ├── components/          # 公共组件
│   │   ├── PDFViewer/      # PDF查看器组件
│   │   ├── Translator/     # 翻译对照组件
│   │   ├── ChatPanel/      # 对话面板组件
│   │   └── common/         # 通用UI组件
│   ├── pages/              # 页面组件
│   │   ├── Home/           # 首页（上传）
│   │   └── Reader/         # 阅读页面
│   ├── services/           # API服务
│   ├── stores/             # 状态管理
│   ├── styles/             # 全局样式（水墨风格主题）
│   ├── utils/              # 工具函数
│   └── App.tsx
```

#### 3.1.3 核心功能模块
- **PDF渲染模块**：基于 pdf.js 实现PDF解析和渲染
- **翻译对照模块**：实现原文-译文段落映射和联动高亮
- **对话模块**：WebSocket 实时通信，支持流式输出
- **文本选择模块**：监听文本选中事件，触发工具栏

---

### 3.2 后端架构

#### 3.2.1 技术栈
- **框架**：Spring Boot 3.4.2 + Java 21
- **数据库**：MySQL 8.0
- **缓存**：Redis
- **ORM**：MyBatis-Plus
- **文件存储**：本地存储 / OSS（阿里云/七牛云）
- **AI集成**：
  - OpenAI API (GPT-4)
  - 或百度文心一言API
  - 或智谱AI API

#### 3.2.2 模块划分
```
backend/
├── app/                    # API层
│   └── controller/
│       ├── DocumentController.java      # 文档管理
│       ├── TranslateController.java     # 翻译功能
│       └── ChatController.java          # 对话功能
├── domain/                 # 领域层
│   ├── entity/            # 实体类
│   │   ├── Document.java
│   │   ├── Translation.java
│   │   └── ChatHistory.java
│   ├── repository/        # 数据访问层
│   │   └── mysql/
│   └── service/           # 领域服务
│       ├── DocumentService.java
│       ├── TranslateService.java
│       ├── AiService.java
│       └── PdfParserService.java
└── infrastructure/         # 基础设施层
    ├── config/            # 配置
    ├── ai/                # AI服务适配器
    └── storage/           # 文件存储适配器
```

#### 3.2.3 核心服务

**文档管理服务 (DocumentService)**
- 文档上传、存储、查询
- PDF文本内容提取
- 文档元数据管理

**翻译服务 (TranslateService)**
- 调用AI进行全文翻译
- 段落分割与映射关系管理
- 翻译结果缓存（避免重复翻译）
- 翻译文档导出（PDF/TXT）

**AI服务 (AiService)**
- AI API适配器（支持多种AI服务商）
- Prompt工程
- 流式响应处理
- Token计费统计

**对话服务 (ChatService)**
- 对话上下文管理
- 向量化文档内容（可选，用于RAG）
- 对话历史存储

---

### 3.3 数据库设计

#### 3.3.1 核心表结构

**文档表 (t_document)**
```sql
CREATE TABLE t_document (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT NOT NULL COMMENT '用户ID',
    file_name VARCHAR(255) NOT NULL COMMENT '文件名',
    file_size BIGINT NOT NULL COMMENT '文件大小(字节)',
    file_path VARCHAR(500) NOT NULL COMMENT '文件存储路径',
    file_md5 VARCHAR(32) COMMENT '文件MD5',
    page_count INT COMMENT 'PDF页数',
    text_content TEXT COMMENT '提取的文本内容',
    status TINYINT DEFAULT 0 COMMENT '状态:0-上传中,1-已完成,2-失败',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP,
    update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_user_id (user_id),
    INDEX idx_file_md5 (file_md5)
) COMMENT='文档表';
```

**翻译记录表 (t_translation)**
```sql
CREATE TABLE t_translation (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    document_id BIGINT NOT NULL COMMENT '文档ID',
    source_lang VARCHAR(10) COMMENT '源语言',
    target_lang VARCHAR(10) NOT NULL COMMENT '目标语言',
    translated_content LONGTEXT COMMENT '翻译后的内容(JSON格式存储段落映射)',
    translate_style VARCHAR(20) COMMENT '翻译风格',
    status TINYINT DEFAULT 0 COMMENT '状态:0-翻译中,1-已完成,2-失败',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP,
    INDEX idx_document_id (document_id)
) COMMENT='翻译记录表';
```

**对话历史表 (t_chat_history)**
```sql
CREATE TABLE t_chat_history (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    document_id BIGINT NOT NULL COMMENT '文档ID',
    user_id BIGINT NOT NULL COMMENT '用户ID',
    role VARCHAR(20) NOT NULL COMMENT '角色:user/assistant',
    content TEXT NOT NULL COMMENT '对话内容',
    selected_text TEXT COMMENT '选中的文本片段',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP,
    INDEX idx_document_user (document_id, user_id)
) COMMENT='对话历史表';
```

---

## 4. UI/UX设计

### 4.1 水墨风格设计规范

#### 4.1.1 色彩方案
- **主色调**：
  - 墨黑：`#1a1a1a`（主文字、边框）
  - 淡墨：`#666666`（次要文字）
  - 宣纸白：`#f9f7f4`（背景色）
  - 竹青：`#5a8c7e`（强调色、按钮）
  - 朱砂：`#c8553d`（警告、重点）

- **辅助色**：
  - 烟灰：`#d9d9d9`（分割线）
  - 暮霭：`#e8e8e8`（卡片背景）

#### 4.1.2 字体
- **中文**：思源宋体 / 方正书宋
- **英文**：Noto Serif / Georgia
- **代码**：Fira Code

#### 4.1.3 设计元素
- 圆角：小圆角（4px）体现古朴感
- 阴影：柔和阴影模拟宣纸层次感
- 边框：使用淡墨色细线（1px）
- 图标：线性图标，笔触感
- 按钮：扁平风格，悬浮时添加墨晕效果

---

### 4.2 页面布局

#### 4.2.1 首页 (上传页)
```
┌─────────────────────────────────────────┐
│          DocAgent  [导航]               │
├─────────────────────────────────────────┤
│                                         │
│         ┌──────────────────┐            │
│         │                  │            │
│         │   [上传区域]     │            │
│         │  拖拽或点击上传  │            │
│         │                  │            │
│         └──────────────────┘            │
│                                         │
│      [最近文档列表]                     │
│      ┌──────┐ ┌──────┐ ┌──────┐        │
│      │文档1 │ │文档2 │ │文档3 │        │
│      └──────┘ └──────┘ └──────┘        │
│                                         │
└─────────────────────────────────────────┘
```

#### 4.2.2 阅读页 (核心页面)
```
┌─────────────────────────────────────────────────────────┐
│ ← 返回  文档名.pdf     [翻译] [下载] [设置]             │
├──────────────────────┬──────────────────────┬───────────┤
│                      │                      │           │
│   PDF原文区域        │   翻译文本区域       │  对话面板 │
│                      │                      │           │
│  [页码: 1/20]       │  [段落映射高亮]      │ [对话历史]│
│                      │                      │           │
│  [选中文本工具栏]    │  [滚动同步]          │ [输入框] │
│                      │                      │           │
└──────────────────────┴──────────────────────┴───────────┘
```

---

### 4.3 交互设计

#### 4.3.1 选中联动交互
1. 用户在原文区选中文本
2. 系统识别选中文本所在的段落
3. 根据段落映射关系，定位到译文对应段落
4. 译文区域滚动到对应位置并高亮显示（使用淡竹青色背景）
5. 高亮持续3秒后淡出，或用户取消选中后消失

#### 4.3.2 翻译流程反馈
- **翻译前**：按钮显示「翻译」
- **翻译中**：按钮变为加载状态，显示进度百分比
- **翻译完成**：按钮恢复，右侧显示译文，Toast提示「翻译完成」

#### 4.3.3 对话交互
- **用户发送消息**：消息靠右显示，竹青色背景
- **AI回复消息**：消息靠左显示，暮霭色背景
- **流式输出**：AI回复逐字显示，打字机效果
- **选中提问**：选中文本后弹出工具栏，点击「提问」图标，对话面板自动展开并预填充上下文

---

## 5. 非功能性需求

### 5.1 性能要求
- **文档上传**：支持断点续传，大文件分片上传
- **翻译性能**：50页PDF翻译时间 < 5分钟
- **对话响应**：首字响应时间 < 2秒
- **并发支持**：支持100+用户同时在线

### 5.2 安全要求
- 文件上传安全校验（文件类型、大小、病毒扫描）
- 用户权限控制（仅能访问自己的文档）
- 敏感信息脱敏（如果文档包含个人信息）
- HTTPS传输加密

### 5.3 可用性要求
- 系统可用性 ≥ 99.5%
- 数据备份策略：每日增量备份，每周全量备份

---

## 6. 开发计划

### 6.1 迭代规划

#### Phase 1: MVP版本（4周）
**Week 1-2: 基础功能**
- [ ] 项目初始化（前后端框架搭建）
- [ ] 文档上传功能
- [ ] PDF预览功能
- [ ] 数据库设计与实现

**Week 3: 翻译功能**
- [ ] AI翻译服务集成
- [ ] 全文翻译功能
- [ ] 基础对照翻译UI（无联动）
- [ ] 翻译结果下载（TXT格式）

**Week 4: 对话功能**
- [ ] AI对话服务集成
- [ ] 全文对话功能
- [ ] 对话历史存储

#### Phase 2: 核心交互优化（3周）
**Week 5-6: 对照翻译增强**
- [ ] 段落映射算法实现
- [ ] 选中联动高亮功能
- [ ] 滚动同步功能
- [ ] 翻译设置（语言、风格）

**Week 7: 选中提问**
- [ ] 文本选中工具栏
- [ ] 选中内容提问功能
- [ ] 对话面板优化

#### Phase 3: 体验优化（2周）
**Week 8: UI优化**
- [ ] 水墨风格主题定制
- [ ] 响应式布局适配
- [ ] 交互动画优化

**Week 9: 功能完善**
- [ ] 双语对照PDF导出
- [ ] 对话记录导出
- [ ] 性能优化
- [ ] 测试与Bug修复

---

### 6.2 技术风险与应对

| 风险点 | 风险等级 | 应对措施 |
|--------|----------|----------|
| PDF文本提取准确性 | 高 | 使用成熟的PDF.js + 后端Apache PDFBox双重解析 |
| 段落映射算法复杂度 | 中 | 基于段落hash + 顺序索引的简化映射策略 |
| AI翻译成本 | 中 | 实现翻译缓存机制，相同文档避免重复翻译 |
| AI API限流 | 低 | 实现请求队列 + 限流控制 |

---

## 7. 技术决策（已确认 - 2025-11-12）

1. **AI服务商选型**：✅ 使用OpenAI协议（兼容多家模型，方便后续切换）
   - 代码实现遵循OpenAI API标准
   - 支持切换到其他兼容OpenAI协议的模型服务商（如Azure OpenAI、国内大模型厂商的OpenAI兼容接口）

2. **用户体系**：✅ MVP阶段不实现用户登录
   - 使用sessionId进行会话管理
   - 后续迭代再引入完整的用户体系

3. **文件存储**：✅ 本地文件存储
   - 文档存储在服务器本地磁盘
   - 后续可扩展为云存储（阿里云OSS/七牛云）

4. **向量数据库**：✅ MVP阶段不引入
   - 先实现基于全文的问答功能
   - 后续根据效果评估是否引入RAG优化

5. **多文档管理**：实现基础的文档列表功能（首页展示最近上传的文档）

---

## 8. 附录

### 8.1 参考竞品
- ChatPDF
- Kimi Chat（文件阅读功能）
- DeepL Translator

### 8.2 技术参考文档
- React PDF官方文档: https://github.com/wojtekmaj/react-pdf
- Spring Boot官方文档: https://spring.io/projects/spring-boot
- OpenAI API文档: https://platform.openai.com/docs

---

**变更记录**
| 版本 | 日期 | 修改人 | 修改内容 |
|------|------|--------|----------|
| v1.0 | 2025-11-12 | li.hongjian | 初始版本创建 |
